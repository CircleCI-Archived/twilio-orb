commands:
  alert:
    description: Send SMS alert on failure only. This must be the last step in the
      job to work properly.
    parameters:
      authtoken:
        default: ${TWILIO_TOKEN}
        description: null
        type: string
      body:
        default: Notification from CircleCI. A critical test has failed.
        description: The Body parameter includes the full text of the message you
          want to send, limited to 1600 characters.
        type: string
      from:
        default: ${TWILIO_FROM}
        description: |
          This must be a Twilio phone number that you own, formatted with a '+' and country code,
           e.g. +16175551212 (E.164 format). You can also use a Messaging Service SID.
        type: string
      sid:
        default: ${TWILIO_SID}
        description: null
        type: string
      to:
        default: ${TWILIO_TO}
        description: |
          This parameter determines the destination phone number for your SMS message. Format this number with a '+' and a country code, e.g., +16175551212 (E.164 format).
        type: string
    steps:
    - run:
        command: |
          curl -X POST https://api.twilio.com/2010-04-01/Accounts/<< parameters.sid >>/Messages.json \
          --data-urlencode "From=<< parameters.from >>" \
          --data-urlencode "Body=<< parameters.body >>" \
          --data-urlencode "To=<< parameters.to >>" \
          -u << parameters.sid >>:<< parameters.authtoken >>
        name: Sending SMS
        when: on_fail
  sendsms:
    description: Send SMS notifications using Twilio
    parameters:
      authtoken:
        default: ${TWILIO_TOKEN}
        description: null
        type: string
      body:
        default: Notification from CircleCI. You have not yet customized your message.
        description: The Body parameter includes the full text of the message you
          want to send, limited to 1600 characters.
        type: string
      from:
        default: ${TWILIO_FROM}
        description: |
          This must be a Twilio phone number that you own, formatted with a '+' and country code,
           e.g. +16175551212 (E.164 format). You can also use a Messaging Service SID.
        type: string
      sid:
        default: ${TWILIO_SID}
        description: null
        type: string
      to:
        default: ${TWILIO_TO}
        description: |
          This parameter determines the destination phone number for your SMS message. Format this number with a '+' and a country code, e.g., +16175551212 (E.164 format).
        type: string
    steps:
    - run:
        command: |
          curl -X POST https://api.twilio.com/2010-04-01/Accounts/<< parameters.sid >>/Messages.json \
          --data-urlencode "From=<< parameters.from >>" \
          --data-urlencode "Body=<< parameters.body >>" \
          --data-urlencode "To=<< parameters.to >>" \
          -u << parameters.sid >>:<< parameters.authtoken >>
        name: Sending SMS
description: |
  Create custom Twilio SMS notifications for CircleCI jobs
  Source: https://github.com/CircleCI-Public/twilio-orb
display:
  source_url: https://github.com/circleci-public/twilio-orb
examples:
  alert:
    description: This function is the same as the "sendsms" command but will only
      run when the job has failed. This must be the last step in a job to work properly.
    usage:
      orbs:
        jobs:
          build:
            docker:
            - image: <docker image>
            steps:
            - twilio/alert:
                body: Customize alert message for this job
                from: "+16175551212"
                to: "+16175551212"
        twililo: circleci/twililo@volatile
      version: 2.1
  sendsms:
    description: Send a text message with a custom message.
    usage:
      orbs:
        jobs:
          build:
            docker:
            - image: <docker image>
            steps:
            - twilio/sendsms:
                body: This is a custom message notification
                from: "+16175551212"
                to: "+16175551212"
        twililo: circleci/twililo@volatile
      version: 2.1
version: 2.1

